{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Add Historical Data</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css">
    <style>
        #map {
            height: 600px;
            width: 100%;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Add Historical Data</h1>

    <!-- Historical Data Form -->
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Save</button>
    </form>

    <!-- Map for Viewing Plots -->
    <div id="map"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <script>
        // Initialize the map
        const map = L.map('map').setView([51.2134, 12.2692], 14);

        // Add a satellite base layer from ESRI
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            maxZoom: 18,
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
        }).addTo(map);

        // Add GeoJSON layer for plots
        const plotData = {{ plots_geojson|safe }};
        L.geoJSON(plotData, {
            style: { color: 'blue', weight: 2 },
            onEachFeature: function (feature, layer) {
                // Add popup to display plot name
                layer.bindPopup("Plot: " + feature.properties.name);
            }
        }).addTo(map);
    </script>
</body>
</html>
